<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
<meta http-equiv="Content-Language" content="pl">
<meta name="description" content="Strumienie. Co to takiego? Z czym to siê je?">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="keywords" content="programowanie, Delphi, stream, strumienie">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Service for programmers</title>
<link rel="stylesheet" type="text/css" href="../../style.css">
</head>

<body background="../../obrazki/tlo.jpg">

<div align="center">
  <table border="0" width="73%" height="1" cellspacing="0" cellpadding="0" bordercolor="#0000FF">
    <tr>
      <td width="100%" height="63" valign="middle" align="center">
        <p align="left"><img border="0" src="../../obrazki/sfp.gif" width="400" height="80" align="left"><font size="6">Strumienie</font>
      </td>
    </tr>
    <tr>
      <td width="100%" height="20" valign="top" align="center">
      <p align="center"><a href="javascript: history.back()"><img border="0" src="../../obrazki/back.gif" width="14" height="14">
      </a>
      <a href="../../index.html">Strona g³ówna</a>  <a href="javascript: history.forward()"> <img border="0" src="../../obrazki/foward.gif" width="14" height="14">
      </a>
      </td>
    <center>
    </tr>
    <tr>
      <td width="98%" height="1" valign="top">
        <p align="center">&nbsp;<font size="1">[ <a href="../kursy.html">Kursy</a> ] [
        <a href="../pogramy.html">Programy</a>
          ] [ <a href="../kody.html">¬ród³a</a> ] [ <a href="../cgi.html">CGI</a>
          ] [ <a href="../java.html">Java</a> ] [<a href="../delphin.html">Delphi</a>
          ] [ <a href="faq.html">Delphi FAQ 1</a> ] [ <a href="faq2.html">Delphi
          FAQ 2</a> ]<br>
        &nbsp;[ <a href="api.html">WinAPI FAQ</a> ] [ <a href="slownik.html">S³owniczek</a>
          ] [ <a href="../texty.html">Texty</a> ] [ <a href="../przyjaciele.html">Przyjaciele</a>
          ]&nbsp;<br>
          [ <a href="../info.html">Info</a> ] [ <a href="../linki.html">Linki</a>
          ] [ <a href="../algo.html">Algorytmy</a> ] [ <a href="../czat.htm">cz@t</a>
          ]&nbsp;&nbsp;</font>
      </td>
  </center>
    </tr>
    <center>
      <tr>
      <td width="98%" height="748" valign="top">
      &nbsp;
      <p align="center"><b>Strumienie</b></p>
  </center>
      <blockquote>
        <p align="left">Co to s± te strumienie? Jak by to najpro¶ciej wyja¶niæ?
        Otó¿ strumienie to ci±g danych, który mo¿e byæ zapisywany np. w
        pliku. Wyobra¼ sobie tak± ksi±¿kê adresow±. Masz na formie listê
        adresów oraz imion zgrupowanych np. na komponencie typu ListView.
        Chcesz te adresy teraz zapisaæ tak jak to ma miejsce np. w Windowsowej
        ksi±¿ce adresowej. Na koñcu tego artyku³u bêdzie rozwi±zanie tego
        problemu - zapisywanie wszystkiego do jednego pliku i odczytanie. A
        wszystko za pomoc± strumieni.&nbsp;</p>
        <p align="left">Podstawow± klas± dla strumieni jest klasa TStream. To
        od niej wywodz± siê pozosta³e obiekty bêd±ce samodzielnym typem.
        Oto one:</p>
        <ul>
          <li>
            <p align="left">TFileStream - s³u¿y do operacji na plikach;</li>
          <li>
            <p align="left">TMemoryStream - do operacji danych w pamiêci
            komputera;</li>
          <li>
            <p align="left">TResourceStream - operuje na zasobach plików;</li>
          <li>
            <p align="left">TStringStream - s³u¿y do operacji na zmiennych
            tekstowych ( String ).</li>
        </ul>
        <p align="left">W tej chwili pewnie nie wiesz jak to wszystko zastosowaæ
        itp. Ale nie martw siê - zaraz wszystko stanie siê jasne gdy¿
        wykorzystanie strumieni nie jest niczym nadzwyczajnym.&nbsp;</p>
        <p align="left">Np. wykorzystanie typu TResourceStream. Oto przyk³ad
        wyci±gniêcia z naszego programu EXE bitmapy o nazwie 'MOJA', a nastêpnie
        zapisanie tej bitmapy na dysku:</p>
        <pre><b>var</b>
  S : TResourceStream;
<b>begin</b>
  S := TResourceStream.Create(hInstance, 'MOJA', RT_BITMAP);
  S.SaveToFile('C:\main.bmp');
  S.Free;</pre>
        <p align="left">Sam przyznasz, ¿e to nie jest nic trudnego, prawda?
        Najpierw deklarowana jest zmienna typu &quot;TResourceStream&quot;, a
        nastêpnie jest ona tworzona. W konstruktorze zmiennej pierwszym
        parametrem jest uchwyt pliku, drugim nazwa zasobu, a ostatni parametr to
        typ zasobu. Typy zasobów mo¿esz poznaæ w systemie pomocy Delphi pod
        zak³adk± &quot;TResourceStream&quot;.&nbsp;</p>
        <p align="left">No i nastêpnie wyci±gniêty zasób zostaje zapisany na
        dysku.&nbsp;</p>
        <p align="left">Tak jak opisa³em wy¿ej strumienie mog± tak¿e operowaæ
        na plikach. Trzeba jednak podaæ wówczas tryb otwarcia pliku - np:</p>
        <pre><b>var</b>
  S : TFileStream;
<b>begin</b>
  S := TFileStream.Create('C:\plik.txt', fmOpenWrite);</pre>
        <p>Pierwszym parametrem tego konstruktora jest nazwa pliku, którego bêdzie
        dotyczyæ operacja, a drugim parametrem jest w³a¶nie tryb otwarcia.
        Ten parametr mo¿e mieæ nastêpuj±c± warto¶æ:</p>
        <table border="1" width="90%" bordercolor="#B01010" cellspacing="0" cellpadding="0" height="103">
          <tr>
            <td width="38%" bgcolor="#B01010" align="center" height="5"><font color="#FFFFFF"><b>Parametr</b></font></td>
            <td width="62%" bgcolor="#B01010" align="center" height="5"><font color="#FFFFFF"><b>Opis</b></font></td>
          </tr>
          <tr>
            <td width="38%" align="center" height="16">fmCreate</td>
            <td width="62%" align="center" height="16">Tworzy nowy plik je¿eli
              nie istnieje na dysku;</td>
          </tr>
          <tr>
            <td width="38%" align="center" height="20">fmOpenRead</td>
            <td width="62%" align="center" height="20">Otwiera plik jedynie do
              odczytu;</td>
          </tr>
          <tr>
            <td width="38%" align="center" height="15">fmOpenWrite</td>
            <td width="62%" align="center" height="15">Otwiera plik do zapisu;</td>
          </tr>
          <tr>
            <td width="38%" align="center" height="18">fmOpenReadWrite</td>
            <td width="62%" align="center" height="18">Otwiera do zapisu lub do
              odczytu;</td>
          </tr>
        </table>
        <p align="left">¦wietnie - je¿eli masz ju¿ plik otwarty mo¿esz
        przyst±piæ do operacji na tym w³a¶nie pliku.&nbsp;</p>
        <p align="left">Podstawowymi funkcjami s± polecenia zapisu i odczytu.
        Robi± to funkcje zapisu i odczytu:</p>
        <ul>
          <li>
            <p align="left">Write, WriteBuffer - zapisuje dane do pliku;</li>
          <li>
            <p align="left">Read, ReadBuffer - odczyt;</li>
        </ul>
        <p align="left">Ró¿nica pomiêdzy dwoma poleceniami wykonywuj±cymi tê
        sam± czynno¶æ jest taka, ¿e polecenia Read i Write to funkcje i
        zwracaj± liczbê danych wpisanych do pliku. Przyk³adowy zapis rekordu
        do pliku móg³by wygl±daæ tak:&nbsp;</p>
        <pre><b>var</b>
  S : TFileStream;
  Rec : <b>record</b>
    Name : <b>String</b>;
    ID : Byte;
  <b>end</b>;
<b>begin</b>
  Rec.Name := 'Adam';
  Rec.ID := 2;
  S := TFileStream.Create('C:\plik.txt', fmCreate);
  S.WriteBuffer(Rec, SizeOf(Rec));
  S.Free;</pre>
        <p align="left">To spowoduje zapis danych do pliku. Mo¿esz teraz np.
        dopisaæ do istniej±cych danych kolejny rekord - s³u¿y do tego
        polecenie Seek:</p>
        <pre>  S := TFileStream.Create('C:\plik.txt', fmOpenWrite);
  S.Seek(SizeOf(Rec), soFromEnd);</pre>
        <p align="left">W tym wypadku polecenie Seek przesunie miejsce zapisu
        danych na sam koniec. Pierwszym parametrem jest wielko¶æ danych - okre¶lone
        jest to poprzez SizeOf. Kolejny parametr to miejsce w którym ma siê
        rozpocz±æ operacja zapisu. W tym wypadku bêdzie to na samym koñcu pliku.
        Mo¿esz w tym miejscu podaæ dowoln± warto¶æ lub:&nbsp;</p>
        <ul>
          <li>
            <p align="left">soFromBeginning - na samym pocz±tku;</li>
          <li>
            <p align="left">soFromCurrent - aktulne miejsce;</li>
          <li>
            <p align="left">soFromEnd - sam koniec;</li>
        </ul>
        <p align="left">&nbsp;</p>
        <p align="left">Do okre¶lenia ilo¶ci rekordów znajduj±cych siê w
        pliku mo¿esz zastosowaæ co¶ takiego:</p>
        <pre>  Rozmiar := S.Size <b>div</b> SizeOf(Rec);</pre>
        <p align="left">Zmienna Rozmiar bêdzie zawieraæ ilo¶æ rekordów.
        Zasada jest prosta: w³a¶ciwo¶æ Size okre¶la ilo¶æ bajtów
        zapisanych w pliku - dziel±c to przez rozmiar ( w bajtach ) rekordu
        otrzymamy ilo¶æ rekordów znajduj±cych siê w pliku.</p>
        <p align="left">Istnieje jeszcze polecenie Position, która okre¶la
        aktualn± pozycje w pliku.&nbsp;</p>
        <p align="left">To w³a¶ciwie wszystko co najwa¿niejsze.&nbsp;</p>
        <p align="left">Strumienie umo¿liwiaj± tak¿e zapisywanie do pliku
        ustawieñ komponentów - np. po³o¿enia komponentu na formie itp. Do
        tego s³u¿± polecenia: WriteComponent oraz ReadCompoennt.</p>
        <p align="left">Proszê bardzo - zapisanie komponentu o nazwie &quot;btnMove&quot;
        do pliku:</p>
        <pre><b>var</b>
  FileStream : TFileStream;
<b>begin</b>
  <b>if</b> FileExists('setup.txt') <b>then</b> <i><font color="#000080">// jezeli istnieje plik</font></i>
    FileStream := TFileStream.Create('setup.txt', fmOpenWrite) <b>else</b>
  FileStream := TFileStream.Create('setup.txt', fmCreate); <i><font color="#000080">//w przeciwnym wypadku stworz plik</font></i>

  FileStream.WriteComponent(btnMove); <i><font color="#000080">// zapisz ustawienia komponentu TButton</font></i>
  FileStream.Free; <font color="#000080"><i>// zwolnij zmienna</i></font></pre>
        <p align="left">W tym wypadku je¿eli plik nie istnieje to zostanie
        stworzony, a je¿eli istnieje - zostanie jedynie otwarty do
        zapisu.&nbsp;</p>
        <p align="left">Teraz odczyt wygl±da bardzo podobnie:&nbsp;</p>
        <pre><b>procedure</b> TMainForm.FormCreate(Sender: TObject);
<b>var</b>
  FileStream : TFileStream;
<b>begin</b>
  <b>if</b> <b>not</b> FileExists('setup.txt') <b>then</b> Exit; <i><font color="#000080">//jezeli plik nie istnieje - nie rob nic</font></i>
  
  FileStream := TFileStream.Create('setup.txt', fmOpenRead); <i><font color="#000080">//otworz tylko do odczytu</font></i>
  FileStream.ReadComponent(btnMove);  <i><font color="#000080">// odczytaj ustawienia komponentu</font></i>
  FileStream.Free;
<b>end</b>;</pre>
        <p align="left">Istnieje jeszcze jedna przydatna funkcja - CopyFrom.
        Przedstawia siê ona nastêpuj±co:</p>
        <pre><b>function</b> CopyFrom ( Source: TStream; Count: Longint ) : Longint; </pre>
        <p align="left">S³u¿y ona do przypisania jednemu strumieniowi warto¶ci
        drugiego strumienia.&nbsp;</p>
        <p align="left">Polecam ¶ci±gniêcie ¼ród³a programu
        &quot;Kartoteka&quot;, który wykorzystuj±c strumienie zapisuje do
        pliku nazwê oraz e-mail. Jest to taka ksi±¿ka adresowa.&nbsp;</p>
        <p align="left">Przydatne linki:</p>
        <ul>
          <li>
            <p align="left">Klasy - opis klas - jak siê je tworzy?</li>
        </ul>
        <p align="left">¬ród³a:</p>
        <ul>
          <li>
            <p align="left"><img border="0" src="../../obrazki/zipicon.gif" align="center" width="19" height="19"><a href="../../dane.zip">Dane.zip</a>
            ( 174 kB ) - ksi±¿ka adresowa;</li>
          <li>
            <p align="left"><img border="0" src="../../obrazki/zipicon.gif" align="center" width="19" height="19"><a href="http://www.sfp.hg.pl/stream.zip">Stream.zip</a>
            ( 2 kB ) - przyk³ad wykorzystania strumieni;&nbsp;</li>
        </ul>
        <p align="left"><a href="mailto:boduch@poland.com">Adam Boduch</a></p>
    <center>
        <p>&nbsp;</p>
        </blockquote>
      </center>
      </td>
      </tr>
      <tr>
      <td width="98%" height="61" valign="top">
        <p align="center">&nbsp;<font size="1">[ <a href="../kursy.html">Kursy</a> ] [
        <a href="../pogramy.html">Programy</a>
          ] [ <a href="../kody.html">¬ród³a</a> ] [ <a href="../cgi.html">CGI</a>
          ] [ <a href="../java.html">Java</a> ] [<a href="../delphin.html">Delphi</a>
          ] [ <a href="faq.html">Delphi FAQ 1</a> ] [ <a href="faq2.html">Delphi
          FAQ 2</a> ]<br>
        &nbsp;[ <a href="api.html">WinAPI FAQ</a> ] [ <a href="slownik.html">S³owniczek</a>
          ] [ <a href="../texty.html">Texty</a> ] [ <a href="../przyjaciele.html">Przyjaciele</a>
          ]&nbsp;<br>
          [ <a href="../info.html">Info</a> ] [ <a href="../linki.html">Linki</a>
          ] [ <a href="../algo.html">Algorytmy</a> ] [ <a href="../czat.htm">cz@t</a>
          ]&nbsp;&nbsp;</font>
      </td>
      </tr>
    <tr>
      <td width="98%" height="15" valign="top">
        <p align="center"><font size="1">Copyright (c) 2000/2001 by <a href="mailto:boduch@poland.com"> Service for
        programmers</a></font>
      </td>
    </tr>
    </table>
</div>

</body>

</html>
